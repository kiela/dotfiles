#!/usr/bin/env bash

git-all-repos() {
	local __current_dir=$1
	local __git_cmd=$2
	local __git_args=${@:3}

	echo "Pulling in latest changes for all repositories..."

	for repo in $(find . -type d -name ".git" -print0 | xargs -0 -n1 dirname); do
		cd "$repo"

		if [ $(git remote | wc -l) -gt 0 ]; then
			echo ""
			echo "$(tput setaf 2)"$repo"$(tput sgr0)"
			if [ -z "$__git_args" ]
			then
				git branch | awk '{print $2}' | xargs git $__git_cmd origin
			else
				git $__git_cmd $__git_args
			fi
		fi

		cd $__current_dir
	done

	echo ""
	echo "Completed!"
}

git-all-repos $(pwd) $@
