#!/usr/bin/env sh

V=${V:-false}

__debug()
{
  if $V; then
    echo "DEBUG: $@"
  fi
}

__execute()
{
  __debug "$@"
  eval "$@"
}

_cmd=""
_args=()

if [[ $# -eq 0 ]]; then
  _cmd="help"
else
  _cmd=$1
  shift

  for _arg in "$@"; do
    if [[ $_arg == *.yaml || $_arg == *.yml ]]; then
      _args+=("/etc/vector/$_arg")
    else
      _args+=("$_arg")
    fi
  done
fi

__execute "docker run -i -v $(pwd)/:/etc/vector/ --rm timberio/vector:0.31.0-alpine $_cmd ${_args[@]}"
